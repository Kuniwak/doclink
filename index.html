<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>doclink live demo</title>
	<link rel="stylesheet" type="text/css" href="google-code-prettify/prettify.css" media="all" />
	<link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css" media="all" />
	<link rel="stylesheet" type="text/css" href="style.css" media="all" />
	<style type="text/css">
		.active {
			text-decoration: underline;
		}
	</style>
</head>
<body>
	<!-- Facebook {{{ -->
	<div id="fb-root"></div>
	<script>(function(d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) return;
		js = d.createElement(s); js.id = id;
		js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));</script>
	<!-- }}} -->
	<div class="container">
		<div id="ie" class="alert alert-error"><strong>Warning!</strong> This demo cannot work on Internet explorer. Please try <a href="https://www.google.com/chrome/">Google Chrome</a> or <a href="https://www.mozilla.org/firefox/">Mozilla Firefox</a> or <a href="http://www.opera.com/">Opera</a>.</div>
		<div class="page-header">
			<h1>
				doclink live demo
				<a href="https://travis-ci.org/OrgaChem/doclink"><img src="https://travis-ci.org/OrgaChem/doclink.png?branch=master" alt="Build Status" /></a>
				<a href="https://npmjs.org/package/doclink"><img src="https://badge.fury.io/js/doclink.png" alt="NPM version" /></a>
			</h1>
		</div>
		<div class="row">
			<div class="span6">
				<h2>What is doclink?</h2>
				<a href="https://github.com/OrgaChem/doclink">doclink</a> is a JavaScript module provides to link doc comments to AST nodes as link targets.
				This module is available on <a href="https://github.com/OrgaChem/doclink">github</a> or <a href="https://npmjs.org/package/doclink">npm</a>.
				<hr />
				<h2>Let's try!</h2>
				<textarea id="input" class="span6" rows="10" cols="40">/**
 * Doclink provides to link this doc comments to
 */
the.AST.Node = 'as the link target.';

/**
 * Most AST nodes are linkable
 */
likeThis();</textarea>
				<div id="success" class="alert alert-success">Done!</div>
				<div id="err" class="alert alert-error">
					<h4>Syntax Error</h4>
					<pre id="err-msg"></pre>
				</div>
				<hr />
				<h4>Any questions?</h4>
				Please ask <a href="https://twitter.com/orga_chem">@orga_chem</a> on Twitter.
				<hr />
				<!-- SNS container {{{-->
				<table>
					<tr>
						<td>
						<!-- Github {{{ -->
							<iframe class="github-button" src="http://ghbtns.com/github-btn.html?user=OrgaChem&amp;repo=doclink&amp;type=watch&amp;count=true"></iframe>
						<!-- }}} -->
						</td>
						<!-- Twitter {{{ -->
						<td>
							<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://orgachem.github.io/doclink/" data-via="orga_chem" data-lang="en">Tweet</a>
							<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
						</td>
						<!-- }}} -->
						<!-- Google plus {{{ -->
						<td>
							<!-- Place this tag where you want the +1 button to render. -->
							<div class="g-plusone" data-size="medium" data-href="http://orgachem.github.io/doclink/"></div>

							<!-- Place this tag after the last +1 button tag. -->
							<script type="text/javascript">
								(function() {
									var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
									po.src = 'https://apis.google.com/js/plusone.js';
									var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
								})();
							</script>
						</td>
						<!-- }}} -->
						<!-- Facebook {{{ -->
						<td>
							<div class="fb-like" data-href="http://orgachem.github.io/doclink/" data-send="false" data-layout="button_count" data-width="450" data-show-faces="false"></div>
						</td>
						<!-- }}} -->
					</tr>
				</table>
				<!--}}}-->
			</div>
			<div class="span6">
				<h2>Live preview</h2>
				You can see a doc link by hover on any comment or token.
				<pre id="output" class="prettyprint lang-js linenums"></pre>
				<hr />
				<h2>Object structure</h2>
				<pre id="output-json" class="prettyprint lang-js linenums"></pre>
			</div>
		</div>
		<div class="footer">
			<p><a href="https://github.com/OrgaChem/doclink" target="_blank">doclink</a> licensed under <a href="http://orgachem.mit-license.org/" target="_blank">MIT</a>.</p>
			<p><a href="http://twitter.github.io/bootstrap/index.html" target="_blank">Twitter Bootstrap</a> licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License v2.0</a>.</p>
			<p><a href="http://glyphicons.com/" target="_blank">Glyphicons Free</a> licensed under <a href="http://creativecommons.org/licenses/by/3.0/" target="_blank">CC BY 3.0.</a></p>
			<p><a href="http://validator.w3.org/check?uri=http%3A%2F%2Forgachem.github.io%2Fdoclink%2F"><img src="http://orgachem.github.io/doclink/valid_html5.png" alt="This page is valid HTML5." /></a></p>
		</div>
	</div>
	<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	<script type="text/javascript" src="google-code-prettify/prettify.js"></script>
	<script type="text/javascript">prettyPrint();</script>
	<script type="text/javascript">
		if (navigator.userAgent.indexOf("MSIE") >= 0) {
			$(function() { $('#ie').show(); });
		}
	</script>
	<script type="text/javascript" src="esprima/esprima.js"></script>
	<script type="text/javascript" src="estraverse/estraverse.js"></script>
	<script type="text/javascript" src="doclink/doclink.js"></script>
	<script type="text/javascript">
		var input = $('#input');
		var output = $('#output');
		var outputJson = $('#output-json');
		var success = $('#success');
		var err = $('#err');
		var errMsg = $('#err-msg');
		$('#err-close').click(function() { err.hide(); });

		function onchange(e) {
			var ast, doclinks;
			try {
				ast = esprima.parse(input.val(), { comment: true, range: true });
				doclinker = doclink.analyze(ast);

				output.text(input.val()).removeClass('prettyprinted');

				outputJson.text(JSON.stringify(doclinker.links, function(key, value) {
					// Private member should be not listed.
					return key.toString().match(/_$/) ? undefined : value;
				}, '  ')).removeClass('prettyprinted');

				prettyPrint();

				doclinker.links.forEach(function(docLink) {
					var commentElements = $(getElementsByRange(docLink.comment.range));
					var tokenElements = $(getElementsByRange(docLink.target.range));

					commentElements.add(tokenElements).bind({
						mouseenter: function(e) {
							commentElements.addClass('active');
							tokenElements.addClass('active');
						},
						mouseleave: function(e) {
							commentElements.removeClass('active');
							tokenElements.removeClass('active');
						}
					});
				});

				err.hide();
				success.show();
			}
			catch (synErr) {
				errMsg.text(synErr.message);
				success.hide();
				err.show();
			}
		}

		function getElementsByRange(range) {
			var start = range[0];
			var end = range[1];
			var count = 0;
			var lines = output.find('li');
			var elements = [];

			lines.each(function(idx, line) {
				var tokens = $(line).children('span');

				tokens.each(function(idx, token) {
					if (count >= range[0] && count <= range[1]) {
						elements.push(token);
					}
					count += $(token).text().length;
				});
				count += 1; // count line break.
			});

			return elements;
		}

		input.change(onchange);
		onchange();
	</script>
</body>
</html>
<!-- vim:set foldmethod=marker: -->
